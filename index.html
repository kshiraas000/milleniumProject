<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Millennium Order Entry</title>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Serif:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
        box-sizing: border-box;
        font-family: 'IBM Plex Serif', Georgia, serif;
        }
    
        body {
        margin: 0;
        background-color: #ffffff;
        color: #1c1c1c;
        }
    
        .header {
        background-color: #ffffff;
        padding: 20px 40px;
        border-bottom: 1px solid #e0e0e0;
        }
    
        .header h1 {
        color: #0047FF;
        font-size: 2rem;
        margin: 0;
        }
    
        .main {
        padding: 40px;
        background-color: #f5f7fa;
        }
    
        .card {
        background-color: white;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 30px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
    
        .card h2 {
        color: #0047FF;
        margin-top: 0;
        }
    
        input, select, button {
        margin: 10px 10px 10px 0;
        padding: 10px 12px;
        border: 1px solid #ccc;
        border-radius: 6px;
        font-size: 14px;
        }
    
        button {
        background-color: #0047FF;
        color: white;
        border: none;
        cursor: pointer;
        }
    
        table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
        }
    
        th, td {
        border: 1px solid #ddd;
        padding: 12px;
        text-align: left;
        }
    
        th {
        background-color: #f0f2f5;
        }
    
        .order-actions button {
        margin-right: 6px;
        }
        .topbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 18px 40px;
        background-color: #ffffff;
        border-bottom: 1px solid #e5e7eb;
        }

        .branding {
        font-size: 1.8rem;
        font-weight: 700;
        color: #0047FF;
        }

        .nav-link {
        color: #0047FF;
        text-decoration: none;
        font-weight: 500;
        font-size: 0.95rem;
        }

        .nav-link:hover {
        text-decoration: underline;
        }

    </style>
    </head>
    
<body>
    <div class="topbar">
        <div class="branding">Millennium</div>
        <div class="nav">
          <a href="#" class="nav-link">Orders History</a>
        </div>
      </div>
    <div class="main">
    <div class="header">Order Entry System</div>

    <div class="form-group">
        <select id="orderCategory">
            <option value="market">Market</option>
            <option value="limit">Limit</option>
            <option value="stop">Stop</option>
            <option value="stop-limit">Stop-Limit</option>
            <option value="trailing-stop">Trailing Stop</option>
          </select>
          
          <select id="orderType">
            <option value="buy">Buy</option>
            <option value="sell">Sell</option>
          </select>
          
          <input type="text" id="symbol" placeholder="Symbol">
          <div id="livePrice" style="margin: 10px 0; font-weight: bold;"></div>
          <input type="number" id="quantity" placeholder="Quantity">
          <input type="number" id="limitPrice" placeholder="Limit Price" style="display: none;">
          <input type="number" id="stopPrice" placeholder="Stop Price" style="display: none;">
          <input type="number" id="trailAmount" placeholder="Trailing Amount" style="display: none;">
          <button onclick="createOrder()">Create</button>
    </div>

    <div class="card">
      <h2>Stock Prediction</h2>
      <input type="text" id="predictSymbol" placeholder="Enter Stock Symbol">
      <button onclick="fetchPrediction()">Predict</button>
      <div id="predictionResult" style="margin-top: 10px; font-weight: bold;"></div>
    </div>

    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Type</th>
          <th>Symbol</th>
          <th>Quantity</th>
          <th>State</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="ordersTableBody"></tbody>
    </table>
  </div>

  <script>
    document.getElementById("orderCategory").addEventListener("change", function () {
    const category = this.value;

    document.getElementById("limitPrice").style.display = (category === "limit" || category === "stop-limit") ? "inline-block" : "none";
    document.getElementById("stopPrice").style.display = (category === "stop" || category === "stop-limit") ? "inline-block" : "none";
    document.getElementById("trailAmount").style.display = (category === "trailing-stop") ? "inline-block" : "none";
    });
    document.getElementById("symbol").addEventListener("input", async function () {
      const symbol = this.value.toUpperCase();
      if (!symbol) return;

      try {
        const res = await fetch(`http://localhost:5001/price/${symbol}`);
        const data = await res.json();
        if (data.price) {
          document.getElementById("livePrice").innerText = `Live Price: $${data.price.toFixed(2)}`;
        } else {
          document.getElementById("livePrice").innerText = "Symbol not found";
        }
      } catch (err) {
        document.getElementById("livePrice").innerText = "";
        console.error("Price fetch failed:", err);
      }
    });
    async function fetchOrders() {
      const res = await fetch("http://localhost:5001/orders");
      const orders = await res.json();
      const body = document.getElementById("ordersTableBody");
      body.innerHTML = "";
      orders.forEach(order => {
        body.innerHTML += `
          <tr>
            <td>${order.id}</td>
            <td>${order.order_type}</td>
            <td>${order.symbol}</td>
            <td>${order.quantity}</td>
            <td>${order.state}</td>
            <td class="actions">
              <button onclick="executeOrder(${order.id})">Execute</button>
              <button onclick="cancelOrder(${order.id})">Cancel</button>
            </td>
          </tr>`;
      });
    }

    async function createOrder() {
        const order_type = document.getElementById("orderCategory").value;
        const symbol = document.getElementById("symbol").value;
        const quantity = parseInt(document.getElementById("quantity").value);
        const limit_price = parseFloat(document.getElementById("limitPrice").value) || null;
        const stop_price = parseFloat(document.getElementById("stopPrice").value) || null;
        const trail_amount = parseFloat(document.getElementById("trailAmount").value) || null;

        await fetch("http://localhost:5001/orders", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
            order_type,
            symbol,
            quantity,
            limit_price,
            stop_price,
            trail_amount
            })
        });

        fetchOrders();
    }

    async function executeOrder(id) {
      await fetch(`http://localhost:5001/orders/${id}/execute`, { method: "PUT" });
      fetchOrders();
    }

    async function cancelOrder(id) {
      await fetch(`http://localhost:5001/orders/${id}/cancel`, { method: "PUT" });
      fetchOrders();
    }

    async function fetchPrediction() {
        const symbol = document.getElementById("predictSymbol").value.toUpperCase();
        if (!symbol) {
            alert("Please enter a stock symbol.");
            return;
        }

        try {
            const res = await fetch(`http://localhost:5001/predict/${symbol}`);
            const data = await res.json();

            if (data.error) {
                document.getElementById("predictionResult").innerText = "Error: " + data.error;
                return;
            }

            let resultHTML = `<h3>Predicted Prices for ${symbol}</h3>`;
            resultHTML += `<p>Current Price: $${data.current_price}</p>`;
            resultHTML += `<p>Predicted Price (next 7 days): $${data.predicted_price}</p>`;
            resultHTML += `<p>Expected Change: $${data.expected_change}</p>`;
            resultHTML += `<p>Percentage Change: ${data.percentage_change}%</p>`;
            resultHTML += `<p>Trend: ${data.trend}</p>`;

            document.getElementById("predictionResult").innerHTML = resultHTML;

        } catch (err) {
            console.error("Prediction fetch failed:", err);
            document.getElementById("predictionResult").innerText = "Failed to fetch predictions.";
        }
      }


    fetchOrders();
  </script>
</body>
</html>